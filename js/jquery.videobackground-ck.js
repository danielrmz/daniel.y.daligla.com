/*!
 * jQuery Video Background plugin
 * https://github.com/georgepaterson/jquery-videobackground
 *
 * Copyright 2012, George Paterson
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 */(function(a,b,c){"use strict";function d(d){var e=a(b).height(),f=a(c).height();d.settings.resizeTo==="window"?a(d).css("height",f):f>=e?a(d).css("height",f):a(d).css("height",e)}function e(b){a(b.controlbox).append(b.settings.preloadHtml);b.settings.preloadCallback&&b.settings.preloadCallback.call(b)}function f(b){var c=b.find("video").get(0),d;b.settings.controlPosition?d=a(b.settings.controlPosition).find(".ui-video-background-play a"):d=b.find(".ui-video-background-play a");if(c.paused){c.play();d.toggleClass("ui-icon-pause ui-icon-play").text(b.settings.controlText[1])}else if(c.ended){c.play();d.toggleClass("ui-icon-pause ui-icon-play").text(b.settings.controlText[1])}else{c.pause();d.toggleClass("ui-icon-pause ui-icon-play").text(b.settings.controlText[0])}}function g(b){var c=b.find("video").get(0),d;b.settings.controlPosition?d=a(b.settings.controlPosition).find(".ui-video-background-mute a"):d=b.find(".ui-video-background-mute a");if(c.volume===0){c.volume=1;d.toggleClass("ui-icon-volume-on ui-icon-volume-off").text(b.settings.controlText[2])}else{c.volume=0;d.toggleClass("ui-icon-volume-on ui-icon-volume-off").text(b.settings.controlText[3])}}function h(b){b.settings.resize&&a(c).on("resize",function(){d(b)});b.controls.find(".ui-video-background-play a").on("click",function(a){a.preventDefault();f(b)});b.controls.find(".ui-video-background-mute a").on("click",function(a){a.preventDefault();g(b)});b.settings.loop&&b.find("video").on("ended",function(){a(this).get(0).play();a(this).toggleClass("paused").text(b.settings.controlText[1])})}function i(b){a(b.controlbox).html(b.controls);h(b);b.settings.loadedCallback&&b.settings.loadedCallback.call(b)}var j={init:function(c){return this.each(function(){var f=a(this),g="",h="",j=f.data("video-options"),k;if(b.createElement("video").canPlayType){f.settings=a.extend(!0,{},a.fn.videobackground.defaults,j,c);if(!f.settings.initialised){f.settings.initialised=!0;f.settings.resize&&d(f);a.each(f.settings.videoSource,function(){this[1]!==undefined?g=g+'<source src="'+this[0]+'" type="'+this[1]+'">':g=g+'<source src="'+this[0]+'">'});h=h+'preload="'+f.settings.preload+'"';f.settings.poster&&(h=h+' poster="'+f.settings.poster+'"');f.settings.autoplay&&(h+=' autoplay="autoplay"');f.settings.loop&&(h+=' loop="loop"');a(f).html("<video "+h+">"+g+"</video>");f.controlbox=a('<div class="ui-video-background ui-widget ui-widget-content ui-corner-all"></div>');f.settings.controlPosition?a(f.settings.controlPosition).append(f.controlbox):a(f).append(f.controlbox);f.controls=a('<ul class="ui-video-background-controls"><li class="ui-video-background-play"><a class="ui-icon ui-icon-pause" href="#">'+f.settings.controlText[1]+"</a>"+'</li><li class="ui-video-background-mute">'+'<a class="ui-icon ui-icon-volume-on" href="#">'+f.settings.controlText[2]+"</a>"+"</li></ul>");if(f.settings.preloadHtml||f.settings.preloadCallback){e(f);f.find("video").on("canplaythrough",function(){f.settings.autoplay&&f.find("video").get(0).play();i(f)})}else f.find("video").on("canplaythrough",function(){f.settings.autoplay&&f.find("video").get(0).play();i(f)});f.data("video-options",f.settings)}}else{f.settings=a.extend(!0,{},a.fn.videobackground.defaults,j,c);if(!f.settings.initialised){f.settings.initialised=!0;if(f.settings.poster){k=a('<img class="ui-video-background-poster" src="'+f.settings.poster+'">');f.append(k)}f.data("video-options",f.settings)}}})},play:function(b){return this.each(function(){var c=a(this),d=c.data("video-options");c.settings=a.extend(!0,{},d,b);if(c.settings.initialised){f(c);c.data("video-options",c.settings)}})},mute:function(b){return this.each(function(){var c=a(this),d=c.data("video-options");c.settings=a.extend(!0,{},d,b);if(c.settings.initialised){g(c);c.data("video-options",c.settings)}})},resize:function(b){return this.each(function(){var c=a(this),e=c.data("video-options");c.settings=a.extend(!0,{},e,b);if(c.settings.initialised){d(c);c.data("video-options",c.settings)}})},destroy:function(d){return this.each(function(){var e=a(this),f=e.data("video-options");e.settings=a.extend(!0,{},f,d);if(e.settings.initialised){e.settings.initialised=!1;if(b.createElement("video").canPlayType){e.find("video").off("ended");if(e.settings.controlPosition){a(e.settings.controlPosition).find(".ui-video-background-mute a").off("click");a(e.settings.controlPosition).find(".ui-video-background-play a").off("click")}else{e.find(".ui-video-background-mute a").off("click");e.find(".ui-video-background-play a").off("click")}a(c).off("resize");e.find("video").off("canplaythrough");e.settings.controlPosition?a(e.settings.controlPosition).find(".ui-video-background").remove():e.find(".ui-video-background").remove();a("video",e).remove()}else e.settings.poster&&e.find(".ui-video-background-poster").remove();e.removeData("video-options")}})}};a.fn.videobackground=function(b){if(!this.length)return this;if(j[b])return j[b].apply(this,Array.prototype.slice.call(arguments,1));if(typeof b=="object"||!b)return j.init.apply(this,arguments);a.error("Method "+b+" does not exist on jQuery.videobackground")};a.fn.videobackground.defaults={videoSource:[],poster:null,autoplay:!0,preload:"none",loop:!1,controlPosition:null,controlText:["Play","Pause","Mute","Unmute"],resize:!0,preloadHtml:"",preloadCallback:null,loadedCallback:null,resizeTo:"document"}})(jQuery,document,window);